<PlatformWrapper platform="unity">

This page provides the release notes for the Agora Unity SDK.

## Known issues and limitations

#### Compatibility with macOS Monterey 12

As of v3.4.5, the SDK supports macOS Monterey 12. For the SDK versions between v3.2.1 and v3.4.2 inclusive, crashes occur on macOS Monterey 12. To fix this issue, upgrade the SDK to v3.4.5 or later.

#### Compatibility with iOS 15

As of v3.4.6, the SDK supports iOS 15. For the SDK versions between v3.2.1 and v3.4.5 inclusive, crashes occur on iOS 15. To fix this issue, upgrade the SDK to v3.4.6 or later.

#### Rosetta translation issue

If your app is integrated with the SDK earlier than v3.3.1, the app can only run under Rosetta translation on Mac devices with the M1 chip, which causes a memory leak when a user frequently joins and leaves a channel.

To avoid this issue, upgrade the SDK to v3.3.1 or later and adapt the app to x86-64 and arm64 architectures.

## v3.7.1

v3.7.1 was released on Sep 28, 2022.

#### Improvements

**Co-hosting across channels**

This release enhances the connection mechanism between the SDK and the server of co-hosting across channels and therefore reduces the failure rate.

#### Issues fixed

This release fixed the following issues:

- The local user received the `OnRemoteAudioStateChangedHandler(2,6)` callback after disconnecting from and reconnecting to a network even though the remote user had not changed the audio state.
- [gatewayRtt](https://api-ref.agora.io/en/video-sdk/ios/3.x/Classes/AgoraChannelStats.html#//api/name/gatewayRtt) reported by the `OnRtcStatsHandler` callback was inaccurate when the network latency was too high or the router did not respond to ICMP packets.
- The uplink network quality reported by the `OnNetworkQualityHandler` callback was inaccurate for the user who was sharing a screen.
- Occasionally, it took users longer than normal to join a channel for the first time.
- (Android, iOS) Occasional crashes occurred.
- (Android) The captured volume was too low on specific devices such as Samsung Galaxy S20+ and Note10+. 
- (iOS) Occasional crashes occurred when you called `PlayEffect` or `StartAudioMixing` to play 8-bit PCM-encoded audio in the WAV format. 
- (iOS) The local audio error reason reported by the `OnLocalAudioStateChangeHandler` callback after a user denied microphone permission was inaccurate. 
- (Windows) Occasionally, the app got stuck after a user joined a channel. 


## v3.7.0.3

v3.7.0.3 was  developed from v3.7.0.1 and released on Jun 22.

This release fixed the following issues:

- [gatewayRtt](https://api-ref.agora.io/en/video-sdk/ios/3.x/Classes/AgoraChannelStats.html#//api/name/gatewayRtt) reported by the `OnRtcStatsHandler` callback was inaccurate when the network latency was too high or the router did not respond to ICMP packets.
- The local user received the `OnRemoteAudioStateChangedHandler(2,6)` callback after disconnecting from and reconnecting to a network even though the remote user had not changed the audio state.
- Occasionally, it took users longer than normal to join a channel for the first time.
- (Android, iOS) Occasional crashes occurred. 
- (Android) The captured volume was too low on specific devices such as Samsung Galaxy S20+ and Note10+. 
- (iOS) The local audio error reason reported by the `OnLocalAudioStateChangeHandler` callback after a user denied microphone permission was inaccurate. 
- (iOS) Occasional crashes occurred when you called `PlayEffect` or `StartAudioMixing` to play 8-bit PCM-encoded audio in the WAV format. 
- (Windows) Occasionally, the app got stuck after a user joined a channel.

## v3.7.0.1

v3.7.0.1 was released on May 23, 2022.

This release deletes the `usesClearTextTraffic` parameter for the purpose of security compliance. If you want to play an HTTP online music file, ensure that you set this parameter in the project AndroidManifest.xml file. For details, see [StartAudioMixing](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html?transId=037350e0-d666-11ec-8e95-1b7dfd4b7cb0#a37642f8384220a6494232d90e1fbd8c3).


## v3.7.0

v3.7.0 was released on Apr 22, 2022.

#### Compatibility changes

**Log path on macOS**

As of v3.7.0, on macOS, the default SDK log path when disabling the sandbox has changed from `～/Library/Logs/agorasdk.log` to `/Users/<username>/Library/Caches/<App Bundle Identifier>/Logs/agorasdk.log`. If you upgrade the SDK, the old logs are stored at the old path, but the new logs are stored at the new path.

#### New features

**Virtual sound card on macOS**

When calling `EnableLoopbackRecording` for the loopback audio capture, developers typically use common virtual sound cards on macOS, including Soundflower and BlackHole. But these virtual sound cards sometimes experience compatibility issues with the M1 chip or the latest systems, and deferred maintenance.

To improve the loopback audio capture experience, Agora has developed its own virtual sound card: AgoraALD (Agora Audio Loopback Device). You can replace your current virtual sound card with AgoraALD using the following steps:

1. Install AgoraALD. See <Link to="../advanced-features/virtual-sound-card?platform=macos">AgoraALD Virtual Sound Card</Link>
2. Change the value of `deviceName` in the `EnableLoopbackRecording` method to `"AgoraALD"`.

**Spatial audio effect**

This release adds the feature of spatial audio effect, which can add a sense of space to remote users' audio and simulate the audio transmission process in the real world, so as to allow the local user to hear remote users with the spatial audio effect.

To use this feature, contact support@agora.io.

**Local voice pitch**

This release adds the `EnableLocalVoicePitchCallback` method and the `OnLocalVoicePitchInHzHandler` callback, to allow the SDK to report the voice pitch of the local user at the set time interval to the app.

**Reporting the user role switch failure**

This release adds the `OnClientRoleChangeFailedHandler` callback to report the reason for a user role switch failure and the current user role in the interactive live streaming.

**Reasons for connection state changes**

To help users better understand the cause of connection state changes, this release adds the following enumerators in `CONNECTION_CHANGED_REASON_TYPE`:

- `CONNECTION_CHANGED_SAME_UID_LOGIN(19)`: Join the same channel from different devices using the same user ID.
- `CONNECTION_CHANGED_TOO_MANY_BROADCASTERS(20)`: The number of hosts in the channel reaches the upper limit. This enumerator is reported only after the support for 128 hosts is enabled.


#### Improvements

**Channel capacity improvement**

As of this release, a single channel can support up to 128 concurrent online hosts, who can publish audio and video streams at the same time. The number of audience members in a channel is unlimited. Each host or audience member can subscribe to a maximum of 50 hosts at the same time.

To experience this improvement, contact support@agora.io.

**Enhanced deep-learning noise reduction**

Agora has added the option of using a new version of deep-learning noise reduction to further improve audio quality. To experience this feature, contact support@agora.io.

**Cloud proxy**

To enrich application scenarios of the Agora Cloud Proxy, this release updates the cloud proxy types (`CLOUD_PROXY_TYPE`) as follows:

- Changes the meaning of `NONE_PROXY(0)` from "Do not use the cloud proxy" to "Automatic mode". In this mode, the SDK attempts a direct connection to SD-RTN™ and automatically switches to TLS 443 if the attempt fails. As of v3.6.2, the SDK has this mode enabled by default.
- Adds `TCP_PROXY(2)`, which is the TCP (encrypted) mode. In this mode, the SDK always transmits data over TLS 443.

In addition, this release adds the `OnProxyConnectedHandler` callback to report the proxy connection state. For example, when a user calls `SetCloudProxy` and joins a channel successfully, the SDK triggers this callback to report the user ID, the proxy type connected, and the time elapsed from the user calling `JoinChannel` until this callback is triggered.

**Audio device test**

To support testing audio devices after joining a channel, this release improves the following methods and callbacks:

- Adds `OnAudioDeviceTestVolumeIndicationHandler`, which reports the volume information of the audio device being tested.
- Changes call sequence of `StartAudioRecordingDeviceTest`, `StartAudioPlaybackDeviceTest`, and `startAudioDeviceLoopbackTest`. Before v3.7.0, you can call these methods only before joining a channel; as of v3.7.0, you can call these methods either before or after joining a channel. After a successful method call, the SDK triggers the following callbacks:
  - `OnAudioVolumeIndicationHandler` and `OnAudioDeviceTestVolumeIndicationHandler` when you call the methods before joining a channel. Both callbacks report the same volume information. If you upgrade the SDK to v3.7.0 or later, Agora recommendeds using `OnAudioDeviceTestVolumeIndicationHandler`.
  - `OnAudioDeviceTestVolumeIndicationHandler` when you call the methods after joining a channel.

<div class="alert note">Calling <code>StartAudioRecordingDeviceTest</code>, <code>StartAudioPlaybackDeviceTest</code>, or <code>StartAudioDeviceLoopbackTest</code> after joining a channel tests the audio devices that the SDK is using.</div>

**Audio recording**

This release extends `StartAudioRecording` with support for setting recording with dual channels and higher audio quality.

- By adding `recordingChannel` to `AudioRecordingConfiguration`, it enables you to set the recorded audio channel to be mono or dual. Because the actual recorded audio channel is related to the captured audio channel and the integration scheme affects the final recorded audio channel, contact technical support for assistance with stereo recording using `StartAudioRecording`.
- By adding `AUDIO_RECORDING_QUALITY_ULTRA_HIGH(3)` to `AudioRecordingConfiguration.recordingQuality`, it enables you to set the recorded audio quality to ultra-high. Ultra-high quality is the highest quality available in `recordingQuality`. When you record a 10-minute AAC audio file at a sample rate of 32,000 Hz and ultra-high quality, the file size is approximately 7.5 MB.

**Music file playback**

This release optimizes the experience of calling `startAudioMixing` to play music files as follows:

- Reduces issues of audio freezes or no audio when playing music files.
- Increases the accuracy of the audio duration reported by `GetAudioFileInfo`.
- Supports more audio file formats. See [Which audio file formats does the Agora <Vg k="VSDK" /> support](https://docs.agora.io/en/help/general-product-inquiry/audio_format).

**Audio file formats (iOS/macOS)**

This release adds support for playing audio files in the following formats:

- Mono-track online files in MP4 format.
- Multi-track online files in M4A and MP4 formats.

For online MP4 and M4A files, the MOOV atom must be before the MDAT atom.

**playEffect improvements**

This release improves the internal implementation logic of `PlayEffect` to avoid blocking and reduce freezing when playing an audio effect file.

**Audio experience optimization on iOS, macOS and Windows**

This release reduces audio stuttering under network conditions with burst jitter and high packet loss.

**Transmission upgrade**

This release upgrades transmission protocols and algorithms to enhance the SDK‘s ability to counter poor network conditions. At the same time, this release optimizes the scalable video coding capability for multi-user video scenarios to improve user video experience.

#### Fixed issues

This release fixed the following issues:
- (iOS) The app occasionally failed to rejoin a channel after a user left a channel and put the app in the background for a period of time. 
- (Android) Under certain circumstances, zipping noises occurred when using a Redmi 4A phone for live streaming.
- (Windows) Remote users could hear the local user with echoes when the local user was in a specific reverb environment.
- (iOS) When playing a specific audio file in the WAV format with the `StartAudioMixing` method, there was no sound after a certain period of playback.
- (iOS and macOS) Audio stuttered under high jitter networks. 
- (iOS ) Under poor network conditions, you could receive the `OnAudioMixingStateChangedHandler` callback only after a three-second delay after a successful call to `StartAudioMixing`. 
- (iOS) Occasional crashes.

#### API changes

**Added**

- `EnableLocalVoicePitchCallback`
- `OnAudioDeviceTestVolumeIndicationHandler`
- `OnLocalVoicePitchInHzHandler` 
- `OnClientRoleChangeFailedHandler`
- `recordingChannel` in `AudioRecordingConfiguration`
- `enableHighLight`, `highLightWidth`, and `highLightColor` in `ScreenCaptureParameters`
- `CONNECTION_CHANGED_SAME_UID_LOGIN(19)` and `CONNECTION_CHANGED_TOO_MANY_BROADCASTERS(20)` in `CONNECTION_CHANGED_REASON_TYPE`
- `AUDIO_RECORDING_QUALITY_ULTRA_HIGH(3)` in `AudioRecordingConfiguration.recordingQuality`
- `OnProxyConnectedHandler`
- `TCP_PROXY(2)` in `CLOUD_PROXY_TYPE`

**Modified**

- Timing restrictions for the `StartAudioRecordingDeviceTest`, `StartAudioPlaybackDeviceTest`, and `StartAudioDeviceLoopbackTest` method calls. 
- The behavior of `NONE_PROXY(0)` in `CLOUD_PROXY_TYPE`.


## 3.6.1.1

v3.6.1.1 was released on March 8, 2022.

#### Compatibility changes

**1. Error codes returned when the request to join a channel is rejected**

To more accurately report the reason for the failure to join a channel, as of this release, the SDK returns the error code `-17(ERR_JOIN_CHANNEL_REJECTED)` instead of `-5(ERR_REFUSED)` in the following situations:

- When a user who has already joined an `IRtcEngine` channel calls the joining channel method of the `IRtcEngine` class with a valid channel name.
- When a user who has already joined an `AgoraChannel` channel calls the joining channel method of this `AgoraChannel` object. 

**2. Media Push** 

To reduce the difficulty of integrating Media Push, this release optimizes the API design of Media Push and improves the handling of network issues within Media Push clients and servers. You can experience the optimized Media Push functionality with the following new methods:

- `StartRtmpStreamWithoutTranscoding`: Starts pushing media streams to a CDN without transcoding. This method works the same as the old method `AddPublishStreamUrl(false)`.
- `StartRtmpStreamWithTranscoding`: Starts pushing media streams to a CDN and sets the transcoding configuration. This method works the same as calling the old methods `SetLiveTranscoding` and `AddPublishStreamUrl(true)` in sequence.
- `UpdateRtmpTranscoding`: Updates the transcoding configuration. This method works the same as the non-first call to the old method `SetLiveTranscoding`.
- `StopRtmpStream`: Stops pushing media streams to a CDN. This method works the same as the old method `RemovePublishStreamUrl`.

<div class="alert info"> This release deprecates three old methods for CDN live streaming: <code>AddPublishStreamUrl</code>, <code>SetLiveTranscoding</code>, and <code>RemovePublishStreamUrl</code>. Agora recommends that you use the new methods for CDN live streaming and update your code logic by referring to <Link to="/3.x/interactive-live-streaming/advanced-features/media-push?platform={{platform.PATH}}">Media Push</Link>. </div>

Also, as of this release, whether you use the new or old methods for Media Push, you can experience the following improvements:

- Reporting streaming states, errors, and events:

  - In the `RTMP_STREAM_PUBLISH_STATE` state code, adding `RTMP_STREAM_PUBLISH_STATE_DISCONNECTING(5)`: The SDK is disconnecting from the Agora streaming server and CDN. When you call `Remove` or `Stop` to stop the streaming normally, the SDK reports the streaming state as `DISCONNECTING`, `IDLE` in sequence.

  - Renaming `RTMP_STREAM_PUBLISH_ERROR` to `RTMP_STREAM_PUBLISH_ERROR_TYPE` and adding the following to the `RTMP_STREAM_PUBLISH_ERROR_TYPE` error code:

    - `RTMP_STREAM_PUBLISH_ERROR_NOT_BROADCASTER(11)`: The user role is not host, so the user cannot use the CDN live streaming function. Check your application code logic.
    - `RTMP_STREAM_PUBLISH_ERROR_TRANSCODING_NO_MIX_STREAM(13)`: The `UpdateRtmpTranscoding` or `SetLiveTranscoding` method is called to update the transcoding configuration in a scenario where there is streaming without transcoding. Check your application code logic.
    - `RTMP_STREAM_PUBLISH_ERROR_NET_DOWN(14)`: Errors occurred in the host's network.
    - `RTMP_STREAM_PUBLISH_ERROR_INVALID_APPID(15)`: Your App ID does not have permission to use the CDN live streaming function. Refer to <Link to="/3.x/interactive-live-streaming/advanced-features/media-push?platform={{platform.PATH}}#prerequisites">Prerequisites</Link> to enable the CDN live streaming permission.

  - Adding the following to the `RTMP_STREAMING_EVENT` event code:

    - `RTMP_STREAMING_EVENT_ADVANCED_FEATURE_NOT_SUPPORT(3)`: The feature is not supported.
    - `RTMP_STREAMING_EVENT_REQUEST_TOO_OFTEN(4)`: Reserved.

<div class="alert note">To ensure the quality of the CDN live streaming, make sure to handle the business logic according to the state code, error code, and event code.</div>

- Using the HE-AAC v2 audio codec during streaming with transcoding: This is achieved by adding `AUDIO_CODEC_PROFILE_HE_AAC_V2(2)` to `AUDIO_CODEC_PROFILE_TYPE`.

**3. Following the system default audio device** (Windows, macOS)

To help developers more flexibly manage audio device switching, this release adds the following methods 

- `GetAudioPlaybackDefaultDevice`: Gets the default audio playback device of the system.
- `GetDefaultAudioRecordingDevice`：Gets the default audio capturing device of the system.
- `FollowSystemPlaybackDevice`: Sets the audio playback device used by the SDK to follow the system default audio playback device.
- `FollowSystemRecordingDevice`: Sets the audio recording device used by the SDK to follow the system default audio recording device.

On Windows, after initialized, the SDK uses the system default audio device to play and capture audio by default. This release optimizes the default processing logic of the SDK when the system default audio device changes, as follows:

- With versions earlier than v3.6.1.1, the SDK follows the system default audio device only when the following occurs:
  - A user connects a new audio device, and the system default audio device changes to the newly connected audio device.
  - A user disconnects or disables an audio device, and that audio device is being used by the SDK.
- With v3.6.1.1 and later versions, the SDK always follows the system default audio device. If you do not need the SDK to follow the system default audio device, call `FollowSystemPlaybackDevice(false)` and `FollowSystemRecordingDevice(false)`.

**4. Selecting Bluetooth profiles** (iOS)

To ensure connectivity with Bluetooth headsets, as of this release, when a user in the communication profile or a host in the interactive live streaming profile uses a Bluetooth headset, the SDK checks whether the device supports the Hands-Free Profile (HFP), and selects the Bluetooth profile based on the result as follows:

- On a device that supports HFP, the SDK uses HFP, where the audio is captured and played through the Bluetooth headset.
- On a device that does not support HFP, the SDK changes to the Advanced Audio Distribution Profile (A2DP), where the audio is captured through device's microphone and played through the Bluetooth headset.

#### New features

**1. Pausing and resuming the media stream relay across channels** 

In order to enable the host to quickly pause or resume a cross-channel media stream relay, this release adds the following methods and event code:

- `PauseAllChannelMediaRelay`: Pauses the media stream relay to all destination channels.
- `ResumeAllChannelMediaRelay`: Resumes the media stream relay to all destination channels.
- `RELAY_EVENT_PAUSE_SEND_PACKET_TO_DEST_CHANNEL_SUCCESS(12)`: The SDK successfully pauses relaying the media stream to destination channels.
- `RELAY_EVENT_PAUSE_SEND_PACKET_TO_DEST_CHANNEL_FAILED(13)`: The SDK fails to pause relaying the media stream to destination channels.
- `RELAY_EVENT_RESUME_SEND_PACKET_TO_DEST_CHANNEL_SUCCESS(14)`: The SDK successfully resumes relaying the media stream to destination channels.
- `RELAY_EVENT_RESUME_SEND_PACKET_TO_DEST_CHANNEL_FAILED(15)`: The SDK fails to resume relaying the media stream to destination channels.

After a successful method call of `PauseAllChannelMediaRelay` or `ResumeAllChannelMediaRelay`, the SDK triggers the `OnChannelMediaRelayEventHandler` callback to report whether the media stream relay is successfully paused or resumed.

**2. Pushing the external audio frame to a specified position** 

To meet the different processing requirements of external audio frames in different scenarios, this release deprecates `PushAudioFrame(audioFrame)` and adds `PushAudioFrame` with `sourcePos` instead. You can push the external audio frame to one of three positions: after audio capture, before audio encoding, or before local playback. For example, in the KTV scenario, you can push the singing voice to after audio capture, and push the accompaniment to before audio encoding, so that the singing voice is processed by the SDK audio module, but the accompaniment is not affected by the SDK audio module. 

This release also adds `SetExternalAudioSourceVolume`, which enables you to set the volume of external audio frames at a specified position.

**3. Advanced settings of the music file** 

To set the playback speed, audio track, and channel mode of a music file, this release adds the following methods:

- `SetAudioMixingPlaybackSpeed`: Sets the playback speed of the current music file. Agora recommends a value range of [50,400], where 100 represents the original speed.
- `GetAudioTrackCount`: Gets the number of audio tracks of the current music file.
- `SelectAudioTrack`: Specifies the playback audio track of the current music file. The range of index is  [0, `GetAudioTrackCount()`). 
- `SetAudioMixingDualMonoMode`: Sets the channel mode of the current music file to original mode, left channel mode, right channel mode, or mixed channel mode.

**4. Getting audio file information** 

To get the information of any audio file, this release deprecates `GetAudioMixingDuration` and adds `GetAudioFileInfo` instead. After joining a channel, you can call `GetAudioFileInfo` and get information such as duration for the specified audio file in `OnRequestAudioFileInfoHandler`. 

**5. Testing audio call loop** 

To check whether the local audio device and network conditions can guarantee the proper sending and receiving of audio streams, this release adds the `StartEchoTest` [3/3] method. You can call this method before joining a channel to test whether the loop of a user's audio devices and network conditions are working properly. 

Compared to `StartEchoTest` [2/3], `StartEchoTest` [3/3] can secure the test, but cannot support setting the time interval for reporting test results.

#### Improvements

**1. Audio device errors**

This release adds the following error codes in `LOCAL_AUDIO_STREAM_ERROR`:

- `LOCAL_AUDIO_STREAM_ERROR_RECORD_INVALID_ID(9)`, which indicates that the ID of the audio capture device is invalid.
- `LOCAL_AUDIO_STREAM_ERROR_PLAYOUT_INVALID_ID(10)`, which indicates that the ID of the audio playback device is invalid.

**2. Identification and quality testing for 5G mobile networks**

This release adds identification and connection quality testing for 5G mobile networks:

- Adds `NETWORK_TYPE_MOBILE_5G(6)` to `NETWORK_TYPE`. When the local network changes to 5G, the SDK triggers the `OnNetworkTypeChangedHandler` callback to report this network connection type.
- Supports calling `EnableLastmileTest` or `StartLastmileProbeTest` to test the connection quality of the 5G mobile network.

**3. Adapting OpenSL** (Android)

This release adapts OpenSL to reduce the audio delay. It also adds a blacklist to disable OpenSL and enable Java adm on some devices that do not support OpenSL in order to improve the stability of audio functions.

**4. Other improvements**

This release also provides the following improvements:

- In scenarios with high CPU usage, the audio experience is improved when the sound card is used for audio capture.

- After enabling deep-learning noise reduction, the audio experience is improved when using some Bluetooth headsets. 

- Adds support for audio playback devices with S/PDIF (Sony/Philips Digital Interface). (Windows)

- To improve audio quality when a user uses a Bluetooth headset, this release optimizes the logic for selecting Bluetooth profiles and volume types. (Android, iOS)

  - Bluetooth profile: As of this release, the Bluetooth profile used by the SDK is only affected by the user role.

    - If a user in the communication profile or a host in the interactive live streaming profile uses a Bluetooth headset, the Bluetooth headset captures and plays audio through the Hands-Free Profile (HFP).
    - If an audience member in the interactive live streaming profile uses a Bluetooth headset, the Bluetooth headset plays audio through the Advanced Audio Distribution Profile (A2DP).

  - Volume type: This release regulates the volume type. When a user uses a Bluetooth headset, the SDK uses the following volume type:

    | Audio scenario           | User in the communication profile/Host in the interactive live streaming profile | Audience in the interactive live streaming profile |
    | :----------------------- | :----------------------------------------------------------- | :------------------------------------------------- |
    | `DEFAULT`                | In-call volume                                               | Media volume                                       |
    | `CHATROOM_GAMING`        | In-call volume                                               | In-call volume                                     |
    | `GAME_STREAMING`         | In-call volume                                               | Media volume                                       |
    | `CHATROOM_ENTERTAINMENT` | In-call volume                                               | In-call volume                                     |
    | `EDUCATION`              | In-call volume                                               | Media volume                                       |
    | `SHOWROOM`               | In-call volume                                               | Media volume                                       |
    | `MEETING`                | In-call volume                                               | Media volume                                       |

#### Fixed issues

This release fixed the following issues:

- The CDN live streaming failed because of the abnormal resolution of the RTMP streaming URL with a port number.

- In the `GAME_STREAMING` scenario, occasional echo or noise that was caused by inaccurate music detection occurred. 
- When the local user called `MuteAllRemoteAudioStreams` and received `OnRemoteAudioStateChangedHandler(REMOTE_AUDIO_REASON_LOCAL_MUTED)`, `OnRemoteAudioStateChangedHandler(REMOTE_AUDIO_REASON_REMOTE_MUTED)` was incorrectly received after 15 seconds. 
- As of v3.4.5, the return value was inaccurate when you called `JoinChannel` multiple times in a row. 
- The method call of `SetExternalAudioSource` before joining the channel did not take effect. 
- Echoes could occur when you used a fiber optic speaker.
- The SDK additionally triggered the `OnLocalAudioStateChangedHandler` callback to report `LOCAL_AUDIO_STREAM_STATE_CAPTURING(1)` when you called `EnableLocalAudio(false)` after joining a channel. 
- Remote users heard slightly unsynchronized voice and music when a user called `StartAudioMixing` on some Android devices. 
- When using the v3.5.0.3 SDK, the local user could not be heard by remote users when the local user used custom audio capture by the Push method. (Windows, Android)
- The SDK repeatedly triggered the `OnAudioDeviceStateChangedHandler` callback when the user connected or disconnected an audio device. (Windows)
- The system version of Windows was incorrectly recognized on some devices. (Windows)
- When the local user called `EnableLoopbackRecording` to enable loopback audio capturing on some devices, remote users heard the audio being played back twice. (Windows)

- Crashes occurred on some devices running on Windows 7. (Windows)
- When you called `StartAudioDeviceLoopbackTest` to start the audio device loopback test after joining and then immediately leaving a channel, the content of the `AudioVolumeInfo` array reported by the `OnAudioVolumeIndicationHandler` callback was incorrect. (Windows)
- On some Xiaomi devices, the user could not use the device's volume button to adjust the volume after calling `SetEnableSpeakerphone`. (Android)
- On some devices, occasional noises occurred when you used OpenSL. (Android)
- Occasional crashes occurred. (Android)
- On some devices, the main thread got stuck for 1 or 2 seconds after the `SetEnableSpeakerphone` method call. (Android)
- The SoundTouch open-source library occasionally caused crashes when you used `SetLocalVoiceChanger`and `SetLocalVoicePitch`. (Android)
- When a third-party in-ear monitoring library and custom audio source were used and in-ear monitoring was enabled before joining a channel, in-ear monitoring did not take effect. (Android)
- On some Samsung devices, the `AdjustRecordingSignalVolume(0)` method call occasionally failed. (Android)
- Updating the transcoding layout in CDN live streaming occasionally failed under certain circumstances. (Android)
- When using an app integrated with the SDK for real-time communication, if a user answered a system call and returned to the app, the audio route of the SDK changed. For example, when the audio was played through the speaker in the app, if a user answered a system call through the earpiece and returned to the app, the audio route of the SDK changed to the earpiece. (Android)
- Crashes occasionally occurred in audio scenarios. (Android, iOS)
- When a user with the audio profile `AUDIO_PROFILE_MUSIC_HIGH_QUALITY_STEREO(5)` talked to a user with another audio profile, the latter was likely to hear a zipping noise. (Android)
- When a Bluetooth headset and a wired headset were connected to the audio playback device at the same time, the SDK did not trigger `OnAudioRouteChangedHandler` after plugging and unplugging the wired headset multiple times. (Android)
- The SDK caused the Bluetooth to restart and triggered the prompt to turn off the bluetooth when the SDK detected incorrect settings of the Bluetooth. (Android)
- When you were playing an original song, the calling of `SetAudioMixingPitch` to adjust the pitch caused the played song to switch to accompaniment. (Android, iOS)
- In the `EDUCATION` scenario, occasionally the volume became unstable when the user called `EnableLocalAudio` to enable or disable the local audio capture. (Android)
- After you enabled Bitcode settings in Xcode and integrated the `AgoraVideoProcessExtension.xcframework` dynamic library, errors occurred when you uploaded the app to the Apple Store. (iOS)
- The `StartAudioMixing` method call failed to play local iTunes music files starting with `"ipod-library://"`. (iOS)
- Repeated declaration of the `OnUserMutedAudioHandler`, `OnUserEnableVideoHandler`, `OnUserEnableLocalVideoHandler`, and `OnFirstRemoteVideoFrameHandler` functions occurred in the header file. (iOS, macOS)
- When you called `SetAudioMixingPosition` multiple times to set the playback position of the music file after you called `StartAudioMixing` to successfully play music, the music file would most likely be played from the beginning. (iOS)
- In the `AUDIO_SCENARIO_CHATROOM_GAMING` scenario, the moment a user in the channel switched the role from `CLIENT_ROLE_AUDIENCE` to ` CLIENT_ROLE_BROADCASTER`, that user heard a zipping noise. (iOS)
- When `PauseAudioMixing` was called before playing an audio file, and then `StartAudioMixing` was called to play the audio file, playback failed. (iOS)
- The local user occasionally could not hear remote users after calling `SetAudioSessionOperationRestriction`. (iOS)
- When the host in the channel switched their role to `CLIENT_ROLE_AUDIENCE` and then back to `CLIENT_ROLE_BROADCASTER`, the audience heard the host's voice with a voice change effect. (iOS)
- After a user played music with a third-party music player and set the audio scenario to `AUDIO_SCENARIO_CHATROOM_GAMING`, joining a channel could interrupt the music played by the third-party music player. (iOS)
- On some device models, when the audio was played through a speaker, echoes occasionally occurred if the speaker volume was set to the maximum value. (macOS)
- Echoes could occur when a user joined a channel for the first time.  (macOS)
- Occasionally, Web clients could not hear Native clients.  (macOS)

#### API changes

**Added**

- [`PushAudioFrame`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#aa791dd3de749a2a2e144e5e28d0b4170)
- [`SetExternalAudioSourceVolume`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#a07bb1b1736107af4b4cdb2523f093e17)
- [`SetAudioMixingPlaybackSpeed`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#ab09032a08860ae8a3fc2cc390c353320)
- [`GetAudioTrackCount`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#a36fd324b786827c3dfcc7dd4c84026ca)
- [`SelectAudioTrack`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#ab7394e0ee051280637c89c432dc03679)
- [`SetAudioMixingDualMonoMode`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#a79e893c724bc60d3a01d022a69983704)
- [`PauseAllChannelMediaRelay`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#a652e58225c2d13e4f9b3c61e43963a9b)
- [`ResumeAllChannelMediaRelay`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#ae6dd13ac6cd8e77652ee6b6b74be5e8a)
- The following enumerators in [`CHANNEL_MEDIA_RELAY_EVENT`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/namespaceagora__gaming__rtc.html#a02d1e8579142814739af24c65f320d6e):
  - `RELAY_EVENT_PAUSE_SEND_PACKET_TO_DEST_CHANNEL_SUCCESS(12)`
  - `RELAY_EVENT_PAUSE_SEND_PACKET_TO_DEST_CHANNEL_FAILED(13)`
  - `RELAY_EVENT_RESUME_SEND_PACKET_TO_DEST_CHANNEL_SUCCESS(14)`
  - `RELAY_EVENT_RESUME_SEND_PACKET_TO_DEST_CHANNEL_FAILED(15)`
- [`GetAudioFileInfo`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#a6f9438df3f15a0052cc282d42681a655)
- [`OnRequestAudioFileInfoHandler`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/namespaceagora__gaming__rtc.html#a0090cc1f5259b022105d3bb3cea84337)
- `LOCAL_AUDIO_STREAM_ERROR_RECORD_INVALID_ID(9)` and `LOCAL_AUDIO_STREAM_ERROR_PLAYOUT_INVALID_ID(10)` in [`LOCAL_AUDIO_STREAM_ERROR`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/namespaceagora__gaming__rtc.html#a635752ff6077fa96e730f513668a0c04)
-  `NETWORK_TYPE_MOBILE_5G(6)` in [`NETWORK_TYPE`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/namespaceagora__gaming__rtc.html#ad2817b616c08cb15a3505caa75e413b1) 
- [`StartEchoTest`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#a3eed33e686179e037e3cd43c9f597667) [3/3]
- The following enumerators in [`LOCAL_VIDEO_STREAM_ERROR`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/namespaceagora__gaming__rtc.html#a66baa891d5de1a2d43341b5460b2f059)：
  - `LOCAL_VIDEO_STREAM_ERROR_DEVICE_INVALID_ID(10)`
  - `LOCAL_VIDEO_STREAM_ERROR_SCREEN_CAPTURE_WINDOW_OCCLUDED(13)`
  - `LOCAL_VIDEO_STREAM_ERROR_SCREEN_CAPTURE_WINDOW_NOT_SUPPORTED(20)`
- [`StartRtmpStreamWithoutTranscoding`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#a2f0994dbc3b1bb8e23853ffdb67d0dd9)
- [`StartRtmpStreamWithTranscoding`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#a34fbe006d84d0542e652a49492711900)
- [`UpdateRtmpTranscoding`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#a2454acc0080f36a32c98a41d3c7f08ae)
- [`StopRtmpStream`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#a4a48fd2558f15a25e0845e57f08dc7f3)
- `RTMP_STREAM_PUBLISH_STATE_DISCONNECTING(5)` in  [`RTMP_STREAM_PUBLISH_STATE`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/namespaceagora__gaming__rtc.html#a2132250fb5d8c8e0f3e52bf15449f2ff) 
- The following enumerators in [`RTMP_STREAM_PUBLISH_ERROR_TYPE`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/namespaceagora__gaming__rtc.html#acf64f163b1768d834ce6b8cbabcf235d):
  - `RTMP_STREAM_PUBLISH_ERROR_NOT_BROADCASTER(11)`
  - `RTMP_STREAM_PUBLISH_ERROR_TRANSCODING_NO_MIX_STREAM(13)`
  - `RTMP_STREAM_PUBLISH_ERROR_NET_DOWN(14)`
  - `RTMP_STREAM_PUBLISH_ERROR_INVALID_APPID(15)`
- The following enumerators in[`RTMP_STREAMING_EVENT`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/namespaceagora__gaming__rtc.html#a1161b5f270933ebd660b9c29848161aa):
  - `RTMP_STREAMING_EVENT_ADVANCED_FEATURE_NOT_SUPPORT(3)`
  - `RTMP_STREAMING_EVENT_REQUEST_TOO_OFTEN(4)`
- `AUDIO_CODEC_PROFILE_HE_AAC_V2(2)` in  [`AUDIO_CODEC_PROFILE_TYPE`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/namespaceagora__gaming__rtc.html#ac158d8109203b32bfe60cbadf37dfe80) 
- [`GetAudioRecordingDefaultDevice`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_audio_recording_device_manager.html#a817e38006202b733f8608765d7353a7d)
- [`GetAudioPlaybackDefaultDevice`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_audio_playback_device_manager.html#ad91f0d3230c10042498bfecdbbe9a7c5)
- [`FollowSystemPlaybackDevice`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_audio_playback_device_manager.html#a2884fba3f5506bfc6658c431b3a75111)
- [`FollowSystemRecordingDevice`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_audio_recording_device_manager.html#a52fe58871ce03f0893e19173fa77baaa)

**Modified**

- Renamed the enumeration `RTMP_STREAM_PUBLISH_ERROR` to `RTMP_STREAM_PUBLISH_ERROR_TYPE`

**Deprecated**

- `PushAudioFrame`
- `GetAudioMixingDuration`

## v3.5.0.3

v3.5.0.3 was released on September 15, 2021.

#### Compatibility changes

**Changes to audio route behavior**

On Android, to improve user experience, this release improves the following SDK behavior:

- When the SDK uses the media volume, the audio route is affected as follows:

  - With versions earlier than v3.5.0.3, the SDK cannot set the audio route as the earpiece.
  - With v3.5.0.3 and later versions, the SDK can set the audio route as the earpiece. At the same time, the volume type becomes in-call volume. If you switch the audio route to the speakerphone, the SDK sets the volume type back to the media volume.

  <div class="alert info">To learn about the scenarios where the SDK uses the media volume, see <a href="https://docs.agora.io/en/help/integration-issues/system_volume">What is the difference between the in-call volume and the media volume</a>.</div>

- If multiple external audio devices are connected, when the user removes the current playback device, the audio route is affected as follows:

  - With versions earlier than v3.5.0.3, the SDK does not play audio through any audio route, which causes a no-audio issue.
  - With v3.5.0.3 and later versions, the SDK sets the audio route as follows (in order of priority): the external device connected next to last > ... > the external device connected first > `SetEnableSpeakerphone` > `SetDefaultAudioRouteToSpeakerphone` > the default audio route of the SDK.

#### Improvements

- In this release, in scenarios where the AGC is enabled, the convergence time for noise reduction is shortened, which reduces noise fluctuations.

#### Fixed issues

This release fixed the following issues：

- When the local network quality was poor, the downlink network quality rating (`rxQuality`) of remote users reported by the SDK was not accurate.
- After calling `MuteLocaAudioStream(true)` to stop publishing a local audio stream, the local user could hear remote users when the local user joined a channel for the first time. After leaving the channel and joining another channel, occasionally the local user could not hear remote users.
- On Android, occasional failure to update the transcoding layout in Media Push under certain circumstances. 
- Occasional crashes on iOS.
- On iOS, in the meeting scenario, after a remote user enabled local audio capturing in the channel, the local user occasionally heard an echo of the remote user’s audio.
- On macOS, in some audio scenarios, if a user disabled the speakerphone and then joined a channel, the speakerphone was automatically enabled.
- On macOS, after calling `RegisterAudioRawDataObserver` to register the original audio data callback, and calling `EnableLoopbackRecording` to start the sound card capturing, noises occurred when a user played a local audio file.
- On iOS and macOS, the value of `memoryTotalUsageRatio` reported by the `ChannelOnRtcStatsHandler` callback was not accurate.
- On Windows, Android, and iOS, after a remote user called `EnableLoopbackRecording`, occasionally the local user heard an echo of their own audio. 

#### API changes

**Modified**

- [`SetEnableSpeakerphone`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#aa8ef8504581b10975ceb2dc86c133481)
- [`SetDefaultAudioRouteToSpeakerphone`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#a7ed850ab08664fb9b847ac9416e7fec5)


## v3.4.6

v3.4.6 was released on July 23, 2021, and it fixed the following issues:

- On iOS, occasional crash during SDK initialization under certain circumstances. 
- On iOS, when `StartAudioMixing` was called and a percent-encoding URL was passed in this method, the SDK failed to play the corresponding online audio file. 
- On macOS, After connecting the UltraStudio Recorder 3G recording device to the app, a user could not record audio through the UltraStudio Recorder 3G. 
- Failed to run app on Xcode 12 via My Mac (Designed for iPad) on M1 Mac. 
- On Android, low-volume issues occurred when the user used Type-C headphones. 

## v3.4.5

v3.4.5 was released on July 5, 2021. 

#### Compatibility changes

**1. Support for GCM2 encryption**

To further improve the security during real-time audio transmission process, this release adds the following:

- `AES_128_GCM2` and `AES_256_GCM2` encryption modes in `EncryptionMode`. The new GCM encryption modes use a more secure KDF (Key Derivation Function) and support setting the key and salt.
- The `EncryptionKdfSalt` member in `EncryptionConfig` to add the salt for the `AES_128_GCM2` and `AES_256_GCM2` encryption modes.

This release also changes the default encryption mode from `AES_128_XTS` to `AES_128_GCM2`. If you use the default encryption mode in earlier versions, after upgrading the SDK to v3.4.5, ensure that you call `EnableEncryption` and set `EncryptionMode` to `AES_128_XTS`.

See <Link to="/3.x/interactive-live-streaming/advanced-features/channel-encryption?platform={{platform.PATH}}">Media Stream Encryption</Link>.

<div class="alert note">Once you enable the built-in encryption, all users in the same channel must use the same encryption mode and key, including the server-side users such as the Agora recording service.</div>

**2. Audio stream publishing behavior changes**

To flexibly control the publishing state in multiple channels, this release optimizes the `AgoraChannel` class as follows:

- Deprecates the `Publish` and `Unpublish` methods, and adds `MuteLocalAudioStream` instead. You can set the publishing state of the audio stream.
- Adds the `publishLocalAudio` member in `ChannelMediaOptions`. You can set the publishing state when joining a channel.
- After calling `SetClientRole(BROADCASTER)`, the local user publishes audio stream by default.

The above improvements bring the following changes in the `IRtcEngine` class:

- `MuteLocalAudioStream` of `IRtcEngine` does not take effect for channels created by the `AgoraChannel` class, so you need to use the `MuteLocalAudioStream` of the `AgoraChannel` class instead.
- When a user joins a channel by using `JoinChannel` with the `options` parameter, you can set the publishing state.
- If a user joins a channel by calling `JoinChannel` with the `options` parameter, `MuteLocalAudioStream` only takes effect when it is called after `JoinChannel`.

If you upgrade the SDK to v3.4.5 or later, to avoid affecting your service, Agora recommends modifying the implementation of `MuteLocalAudioStream`, `Publish`, and `Unpublish`.

#### Improvements

**1. Compatibility with macOS Monterey 12 and iOS 15**

This release supports macOS Monterey 12 and iOS 15.

**2. Performance optimization**

On Windows, Agora has optimized internal threads of the SDK, which reduces CPU usage by about 20% on low-end devices.

**3. Media Push**

To be more transparent to users about errors and events in Media Push, this release adds the following codes:

- To `OnRtmpStreamingStateChangedHandler`: Error code `RTMP_STREAM_UNPUBLISH_ERROR_OK (100)`, which reports that the streaming has been stopped normally. After you call `RemovePublishStreamUrl` to stop streaming, the SDK returns this error code and state code `RTMP_STREAM_PUBLISH_STATE_IDLE (0)`.
- To `OnRtmpStreamingEventHandler`: Event code `RTMP_STREAMING_EVENT_URL_ALREADY_IN_USE (2)`, which reports that the streaming URL is already being used for Media Push. If you want to start new streaming, use a new streaming URL.

**4. Media device state**

To report media device states more accurately, this release optimizes the enumerations of the `OnAudioDeviceStateChangedHandler` callback as follows:

On Windows:

- Changes the definition of `MEDIA_DEVICE_STATE_ACTIVE (1)` from " The device is idle" to "The device is in use", which is more consistent with its name.
- Adds `MEDIA_DEVICE_STATE_IDLE (0)`, which reports the device is ready for use.

On macOS:

- Changes the definition of `0` from "Added" to "The device is ready for use".
- Changes the value reporting the device is not connected from `1` to `8`.

**5. Music file state**

When you call `StartAudioMixing` after `PauseAudioMixing`, this release adds the `OnAudioMixingStateChangedHandler(AUDIO_MIXING_STATE_STOPPED, AUDIO_MIXING_REASON_STOPPED_BY_USER)`state, which indicates the music file is stopped, before reporting `OnAudioMixingStateChangedHandler(AUDIO_MIXING_STATE_PLAYING, AUDIO_MIXING_REASON_STARTED_BY_USER)`.

#### Fixed issues

This release fixed the following issues:

- The `StartAudioMixing` method could not play the MP3 local music files with the `.m4a` filename extension.
- After a user of the SDK v3.0.0+ left a communication channel that had any user of the SDK versions earlier than 3.0.0 and switched the channel profile to live streaming, the user of the SDK v3.0.0+ set user role to host before joining the next channel, but the client role setting did not take effect.
- Under certain circumstances, an audio delay occasionally occurred 10 minutes after a user joined the channel.
- Under poor network conditions, when you called `StartAudioMixing` to play an online music file, occasionally the SDK response time was too long and caused a freeze.
- Under poor network conditions, users were occasionally unable to switch roles.
- On Android, the PCM dump file could not be printed under certain circumstances.
- On Android, using third-party in-ear monitoring libraries caused crashes.
- On Android, when you frequently called `StartAudioMixing` to play an online music file Under poor network conditions, an ANR pop-up window occasionally appeared.
- On Android, after switching the audio route to Bluetooth, the Bluetooth device occasionally failed to sample audio.
- On Android, after the host enabled an in-ear monitor under poor network conditions, the audience frequently lost audio from the host.
- On some Android devices, after connecting a Bluetooth headset, the speaker still played audio.
- Occasional crashes occurred on some Vivo devices.
- On macOS, when the user in a channel connected or disconnected a media device, the SDK did not trigger the callback to report the media device's state changes.
- On some low-end devices of the MacBook Air series, when the start time of audio recording on the client exceeded 5 seconds, the audio device module (ADM) restarted indefinitely.

#### API Changes

**Added**

- `RTMP_STREAM_UNPUBLISH_ERROR_OK (100)` in [`RTMP_STREAM_PUBLISH_ERROR`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/namespaceagora__gaming__rtc.html?platform=Unity#adf0b94807c88344092613487b0dfa0c9)
- `RTMP_STREAMING_EVENT_URL_ALREADY_IN_USE (2)` in [`RTMP_STREAMING_EVENT`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/namespaceagora__gaming__rtc.html?platform=Unity#a1161b5f270933ebd660b9c29848161aa) 
-  `AES_128_GCM2 (7)` and `AES_256_GCM2 (8)` in [`EncryptionMode`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/namespaceagora__gaming__rtc.html#a94f249e19d1de6e0a6ac2348ace088fb) 
- [`encryptionKdfSalt`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/v3.4.5/structagora__gaming__rtc_1_1_encryption_config.html#ae88de9e9ef42b206d9de307d2f4bc47a) in [`EncryptionConfig`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/structagora__gaming__rtc_1_1_encryption_config.html) 
- [`MuteLocalAudioStream`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html?platform=Unity#a6260eac33b6624824872a7140a229ef3) in `IRtcEngine` 
- [`publishLocalAudio`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/structagora__gaming__rtc_1_1_channel_media_options.html?platform=Unity#ae7cf13e792f38e45ed5a1a35f8c948c7) in [`ChannelMediaOptions`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/structagora__gaming__rtc_1_1_channel_media_options.html)


**Modified**

[`MEDIA_DEVICE_STATE_TYPE`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/namespaceagora__gaming__rtc.html?platform=Unity#ad862a26da27e398f045eb4a95bcfa530)

**Deprecated**

- `Publish` and `Unpublish` in `AgoraChannel`

## v3.4.2

v3.4.2 was released on May, 2021.

#### Compatibility changes

**Extension libraries**

To reduce the app size after integrating the SDK, this release packages some features as extension libraries (with the `Extension` suffix). If you do not need to use the related features, you can remove the corresponding extension libraries and recompile the project.

**Behavior changes**

1. Music file playback state

To monitor the reason why the playback state of a music file changes, this release modifies the `OnAudioMixingStateChangedHandler` callback as follows:

- Replaces the `errorCode` parameter with the `reason` parameter.
- Deprecates `AUDIO_MIXING_ERROR_TYPE` and replaces it with `AUDIO_MIXING_REASON_TYPE` instead. Using `AUDIO_MIXING_REASON_TYPE`, you can get the reason for the change of the playback state, such as start, pause, stop or fail.
- Modifies some logic of reporting `state`. For example, as of this release, when looping music, the SDK triggers the `710` state when each loop is completed or starts.

If you upgrade the SDK to v3.4.2 or later, to avoid affecting your service, Agora recommends that you modify the implementation of `OnAudioMixingStateChangedHandler`.

2. Volume control of microphone

As of this release, the `AdjustRecordingSignalVolume` method only adjusts the volume of the signal captured by the microphone. If you need to adjust the volume of the signal captured by the sound card, use the `AdjustLoopbackRecordingSignalVolume` method instead.

#### New features

**1. Volume control of sound cards**

This release adds the `AdjustLoopbackRecordingSignalVolume` method. You can call this method after calling `EnableLoopbackRecording` to adjust the volume of the signal captured by the sound card.

**2. Playback progress of audio effect files**

To control the playback progress of audio effect files, this release adds the following methods:

- `PlayEffect` [2/2]: Sets the playback position when starting playback of an audio effect file by using the `startPos` parameter.
- `SetEffectPosition`: Sets the playback position after starting playback of an audio effect file.
- `GetEffectDuration`: Gets the duration of a local audio effect file.
- `GetEffectCurrentPosition`: Gets current playback progress of an audio effect file.

Also, this release deprecates the `PlayEffect` [1/2] method. You can use `PlayEffect` [2/2] instead.

#### Improvements

**1. Playback progress of music files**

To control the playback progress of music files, this release is optimized as follows:

- Deprecates the `StartAudioMixing` method and adds a new method with the same name in its place. The new `StartAudioMixing` method allows you to set the playback position when starting playback of a music file by using the `startPos` parameter.
- Deprecates the `GetAudioMixingDuration` method and adds a new method with the same name in its place. The new `GetAudioMixingDuration` method allows you to get the duration of a local music file before playing it.

**2. AirPlay callback**

This release adds support for reporting `AUDIO_ROUTE_AIRPLAY` in the `OnAudioRouteChangedHandler` callback on iOS devices. When you use Apple AirPlay to play audio on an iOS device, the SDK triggers the `OnAudioRouteChangedHandler` callback and reports `AUDIO_ROUTE_AIRPLAY`.

**3. Audio recording**

To set the recording configuration during audio recording, this release adds a new `StartAudioRecording` method and deprecates the old method with the same name. The `config` parameter of the new `StartAudioRecording` method allows you to set the audio recording quality, content, sample rate, and storage path of the recording file.

This release also adds a new error code: `160`. If you call the new `StartAudioRecording` method again before the current recording ends, the SDK reports this error code.

**4. Media device errors**

To help users better understand the cause of local video or audio errors, this release adds the following new error codes to `LOCAL_AUDIO_STREAM_ERROR`:

  - `LOCAL_AUDIO_STREAM_ERROR_NO_RECORDING_DEVICE(6)`, which indicates that the SDK cannot find the local audio-capture device.
  - `LOCAL_AUDIO_STREAM_ERROR_NO_PLAYOUT_DEVICE(7)`, which indicates that the SDK cannot find the local audio-playback device.

**5. URI support**

To meet the requirements of Google Play Store, this release supports accessing a local file through URIs. When you call `StartAudioMixing`, `GetAudioMixingDuration`, `PreloadEffect`, `PlayEffect`, or `GetEffectDuration` and need to access a local file, Agora recommends the following steps:

1. Use [Storage Access Framework](https://developer.android.com/guide/topics/providers/document-provider) to get the URI of the local file.
2. Call [`Uri.toString`](https://developer.android.com/reference/android/net/Uri#toString()) to convert the URI to a string.
3. Pass the string in the `filePath` or `watermarkUrl` parameter.

#### Fixed issues

This release fixed the following issues:

- Crashes occurred in a certain voice conversion scenario.
- The `OnVolumeIndicationHandler` callback returned incorrect volume information after you called `EnableSoundPositionIndication(true)`.
- On Windows, occasional crashes after integrating the `libagora_ai_denoise_extension.dll` library.
- On iOS, joining the channel occasionally failed when a user switched back to the app after keeping it in the background for a long time.
- On Android, crashes occurred when the audio sample rate exceeded 4.8 kHz.

#### API changes

**Added**

- [`AdjustLoopbackRecordingSignalVolume`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#a2b44e09cccfed942c6df06551d3aca29)
- [`GetAudioMixingDuration`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#a581955d6b97a81c7edf2b9aea88cfcb2) [2/2]
- [`StartAudioRecording`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#a3fde78b23f4f36610c15d22f9392f2ca) [3/3]
- [`GetEffectDuration`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_audio_effect_manager_impl.html#a9dbc262a96b256b3fcc04c510cc8666a)
- [`SetEffectPosition`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_audio_effect_manager_impl.html#a89bf6f0ae950354545dc94f94609b753)
- [`GetEffectCurrentPosition`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_audio_effect_manager_impl.html#a415b3e9805bbf513039ed7ef48c74bd8)
- [`PlayEffect`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_audio_effect_manager_impl.html#a221f53a8c7c857c1b94133f481a9c3d4) [2/2]
- [`StartAudioMixing`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#a37642f8384220a6494232d90e1fbd8c3) [2/2]
- `LOCAL_AUDIO_STREAM_ERROR_NO_RECORDING_DEVICE(6)` and `LOCAL_AUDIO_STREAM_ERROR_NO_PLAYOUT_DEVICE(7)` in [`LOCAL_AUDIO_STREAM_ERROR`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/namespaceagora__gaming__rtc.html#a635752ff6077fa96e730f513668a0c04)
- Error code: `-160`

**Modified**

- [`OnAudioMixingStateChangedHandler`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/namespaceagora__gaming__rtc.html#a41f42633cf2053de2dc6b4dd0a085a1f)

**Deprecated**

- `GetAudioMixingDuration`[1/2]
- `StartAudioRecording`[2/3]
- `PlayEffect`[1/2]
- `StartAudioMixing`[1/2]
- `AUDIO_MIXING_ERROR_TYPE`

## v3.3.1

v3.3.1 was released on March 12, 2021.

#### Compatibility changes

**1. Integration change**

This release adds the following libraries:

| Target platform | Agora basic calculation library | Deep-learning noise reduction library (Optional) |
| :-------------- | :------------------------------ | :----------------------------------------------- |
| Android         | `libagora-core.so`                | `libagora_ai_denoise_extension.so`               |
| iOS             | `AgoraCore.framework`             | `AgoraAIDenoiseExtension.framework`              |
| macOS           | `AgoraCore.framework`             | `AgoraAIDenoiseExtension.framework`              |
| Windows         | `libagora-core.dll`               | `libagora_ai_denoise_extension.dll`              |

**2. Behavior change**

This release deprecates `SetDefaultMuteAllRemoteAudioStreams` and changes the behavior of `Mute`-related methods as follows:

- `Mute`-related methods must be called after joining or switching to a channel; otherwise, the method call does not take effect.
- Methods with the prefix `MuteAll` are no longer the master switch, and each `Mute`-related method independently controls the user's subscribing state. When you call methods with the prefixes `MuteAll` and `MuteRemote` together, the method that is called later takes effect.
- Methods with the prefix `MuteAll` set whether to subscribe to the audio streams of all remote users, including all subsequent users, which means methods with the prefix `MuteAll` contain the function of methods with the prefix `SetDefaultMute`. Agora recommends not calling methods with the prefixes `MuteAll` and `SetDefaultMute` together; otherwise, the setting may not take effect.

See details in <Link to="../best-practices/set-subscribing-state?platform={{platform.PATH}}">Set the Subscribing State</Link>.

#### New features

**1. Native support for the M1 chip**

This release adds native support for the M1 chip, which means the SDK supports both x86-64 and arm64 architectures. As of v3.3.1, apps that integrate the SDK can natively run on Mac devices with the M1 chip, and you no longer need to set the Rosetta translation.

**2. Channel media options**

To help developers control media subscription more flexibly, this release adds the `JoinChannel`2 and `SwitchChannel`2 methods to set whether users subscribe to all remote audio streams in a channel when joining and switching channels.

**3. Cloud proxy**

To improve the usability of the Agora Cloud Proxy, this release adds the `SetCloudProxy` method to set the cloud proxy and allows you to select a cloud proxy that uses the UDP protocol. For details, see <Link to="../basic-features/use-cloud-proxy?platform={{platform.PATH}}">Cloud Proxy</Link>.

**4. Deep-learning noise reduction**

To eliminate non-stationary noise based on traditional noise reduction, this release adds `EnableDeepLearningDenoise` to enable deep-learning noise reduction.

<div class="alert note">Before enabling deep-learning noise reduction, integrate the deep-learning noise reduction library into your project files.</div>

**5. Singing beautifier**

To beautify the voice and add reverberation effects in a singing scenario, this release adds the `SetVoiceBeautifierParameters` method and adds the `SINGING_BEAUTIFIER` enumeration value to `VOICE_BEAUTIFIER_PRESET`.

You can call `SetVoiceBeautifierPreset(SINGING_BEAUTIFIER)` to beautify the male voice and add the reverberation effect for a voice in a small room. For more settings, you can call `SetVoiceBeautifierParameters`(`SINGING_BEAUTIFIER`, `param1`, `param2`) to beautify male or female voices and add reverberation effects for a voice in a small room, large room, or hall.

**6. Voice Conversion**

This release adds the `SetVoiceConversionPreset` method to set a voice conversion effect (to disguise a user's voice). You can use this method to make a male-sounding voice sound steady or deep, and a female-sounding voice sound gender-neutral or sweet. See <Link to="../advanced-features/voice-changer?platform={{platform.PATH}}">Set the Voice Effect</Link>.

**7. Log files**

To ensure the integrity of log content, this release adds the `logConfig` member variable to `RtcEngineContext`. You can use `logConfig` to set the log files output by the Agora SDK when you initialize `IRtcEngine`.

As of v3.3.1, Agora does not recommend using the `SetLogFile`, `SetLogFileSize`, or `SetLogFilter` methods to set the log files.

**8. Data streams**

To support scenarios such as lyrics synchronization and courseware synchronization, this release deprecates the previous `CreateDataStream` method and replaces it with a new method of the same name. You can use this new method to create a data stream and set whether to synchronize the data stream with the audio stream sent to the Agora channel and whether the received data is ordered.

#### Improvements

**1. AES-GCM encryption mode**

For scenarios requiring high security, to guarantee the confidentiality, integrity, and authenticity of data, and to improve the computational efficiency of data encryption, this release adds the following enumerators in `ENCRYPTION_MODE`:

- `AES_128_GCM`: 128-bit AES encryption, GCM mode.
- `AES_256_GCM`: 256-bit AES encryption, GCM mode.

<div class="alert note">Once you enable the built-in encryption, all users in the same channel must use the same encryption mode and key, including the server-side users such as the Agora recording service.</div>

**2. Remote audio statistics**

To monitor quality of experience (QoE) of the local user when receiving a remote audio stream, this release adds the following members to `OnRemoteAudioStatsHandler`:

- `qoeQuality`: Reports QoE of the local user.
- `qualityChangedReason`: Reports the reason for poor QoE.
- `mosValue`: Reports the quality of the remote audio stream as determined by the Agora real-time audio MOS (Mean Opinion Score) measurement system.

#### Fixed issues

This release fixed the following issues:

- After enabling the sound position indication, you could not get the remote user's volume by the `OnVolumeIndicationHandler` callback.
- The audio sampling failed on some Android devices after a headset was plugged in.
- Local audio sampling occasionally failed on Android 10.
- Occasionally, local users could not play remote audio streams.
- 360 Brain of Security (online shopping mode) automatically blocked the application program from running.

#### API changes

**Added**

- [`SetVoiceConversionPreset`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#aee2fb5664266783a9ff855b4ef81e1b6)
- `AES_128_GCM` and `AES_256_GCM` in [`ENCRYPTION_MODE`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/structagora__gaming__rtc_1_1_encryption_config.html)
- [`SetVoiceBeautifierParameters`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#acb6c5d42ea4e14b0f2e7bc8f27bc2def)
- `SINGING_BEAUTIFIER` in [`VOICE_BEAUTIFIER_PRESET`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/namespaceagora__gaming__rtc.html#a95376eca24c67a6c2bee9d0ca2b2e7d6)
- [`EnableDeepLearningDenoise`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#a401707e8917f9af84c3a77e77f0160e5)
- [`JoinChannel`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#ad64ca959b93b2678df44777ad20e2072)2
- [`SwitchChannel`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#a44cde739692d5a4326b918d631170be9)2
- [`CreateDataStream`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#a2779954830d051179e574e1c744fb411)
- `logConfig` in [`RtcEngineConfig`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/structagora__gaming__rtc_1_1_rtc_engine_config.html)
- `qoeQuality`, `qualityChangedReason` and `mosValue` in [`RemoteAudioStats`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/structagora__gaming__rtc_1_1_remote_audio_stats.html)
- [`SetCloudProxy`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#ad354f9ec01a0985f76f82cae1fafee5e)
- `captureWidth` and `captureHeight` in [`CameraCapturerConfiguration`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/structagora__gaming__rtc_1_1_camera_capturer_configuration.html)
- `CAPTURER_OUTPUT_PREFERENCE_MANUAL(3)` in [`CAPTURER_OUTPUT_PREFERENCE`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/namespaceagora__gaming__rtc.html#a6642195eed7dc4bd5457f41992bf0e36)
- Error code: `ERR_MODULE_NOT_FOUND(157)`

**Deprecated**

- `SetDefaultMuteAllRemoteAudioStreams`
- `SetLogFile`
- `SetLogFileSize`
- `SetLogFilter`
- `CreateDataStream`

## v3.2.1

v3.2.1 was released on December 30, 2020.

#### Compatibility changes

**1. Integration change**

Since v3.2.1, the following libraries have been added to the SDK package:

- The Fraunhofer FDK AAC dynamic library.
- The mpg123 dynamic library.
- The SoundTouch dynamic library.

See the added files for each platform as follows:

| Platform | File name                                                    |
| :------- | :----------------------------------------------------------- |
| Android | <li>`libagora-fdkaac.so`</li><li>`libagora-mpg123.so`</li><li>`libagora-soundtouch.so`</li> |
| iOS     | <li>`Agorafdkaac.framework`</li><li>`AgoraSoundTouch.framework`</li>|
| macOS     | <li>`Agorafdkaac.framework`</li><li>`AgoraSoundTouch.framework`</li>|
| Windows | <li>`libagora-fdkaac.dll`</li><li>`libagora-mpg123.dll`</li><li>`libagora-soundtouch.dll`</li> |

If you upgrade the SDK to v3.2.1, ensure that you have added the above files in your project according to [Quickstart Guide](../quickstart-guide/get-started-sdk).

**2. Cloud proxy**

This release optimizes the Agora cloud proxy architecture. If you are already using cloud proxy, to avoid compatibility issues between the new SDK and the old cloud proxy, please contact [support@agora.io](mailto:support@agora.io) before upgrading the SDK. See <Link to="../basic-features/use-cloud-proxy?platform={{platform.PATH}}">Cloud Proxy</Link>.

**3. Security and compliance**

Agora has passed ISO 27001, ISO 27017, and ISO 27018 international certifications, providing safe and reliable real-time interactive cloud services for users worldwide. See <Link to="../reference/security#iso-certificates?platform={{platform.PATH}}">ISO Certificates</Link>.

This release supports transport layer encryption by adding TLS (Transport Layer Security) and UDP (User Datagram Protocol) encryption methods.

<div class="alert note">Transport layer encryption affects the size of the SDK package. For details, see *Product Overview*.</div>

#### New features

**1. Interactive Live Streaming Standard**

This release adds `SetClientRole` for setting the latency level of an audience member. You can use this method to switch between Interactive Live Streaming Premium and Interactive Live Streaming Standard as follows:

- Set the latency level as ultra low latency to use Interactive Live Streaming Premium.
- Set the latency level as low latency to use Interactive Live Streaming Standard.

For details, see the [product overview](product-overview) of Interactive Live Streaming Standard.

**2. Publishing and subscription states**

This release adds the following callbacks to report the current publishing and subscribing states:

- `OnAudioPublishStateChangedHandler`: Reports the change of the audio publishing state.
- `OnAudioSubscribeStateChangedHandler`: Reports the change of the audio subscribing state.

**3. First local frame published callback**

This release adds the `OnFirstLocalAudioFramePublishedHandler` callback to report that the first audio frame is published, and deprecates the `OnFirstLocalAudioFrameHandler` callback.

**4. Custom data report**

This release adds the `SendCustomReportMessage` method for reporting customized messages. To try out this function, contact [support@agora.io](mailto:support@agora.io) and discuss the format of customized messages with us.

#### Improvement

**1. Regional connection**

This release changes the `AREA_CODE` for regional connection, and adds area codes for Japan and India. The latest area codes are as follows:

- `AREA_CODE_CN`: Mainland China.
- `AREA_CODE_NA`: North America.
- `AREA_CODE_EU`: Europe.
- `AREA_CODE_AS`: Asia, excluding Mainland China.
- `AREA_CODE_JP`: Japan.
- `AREA_CODE_IN`: India.
- `AREA_CODE_GLOB`: (Default) Global.

If you have specified a region for connection when calling `GetEngine`, ensure that you use the latest area code when migrating from an earlier SDK version.

**2. Meeting scenario**

To improve the audio experience for multi-person meetings, this release adds `AUDIO_SCENARIO_MEETING(8)` in `SetAudioProfile`.

**3. Voice beautifier and audio effects**

To improve the usability of the APIs related to voice beautifier and audio effects, this release deprecates `SetLocalVoiceChanger` and `SetLocalVoiceReverbPreset`, and adds the following methods instead:

- `SetVoiceBeautifierPreset`: Compared with `SetLocalVoiceChanger`, this method deletes audio effects such as a little boy’s voice and a more spatially resonant voice.
- `SetAudioEffectPreset`: Compared with `SetLocalVoiceReverbPreset`, this method adds audio effects such as the 3D voice, the pitch correction, a little boy’s voice and a more spatially resonant voice.
- `SetAudioEffectParameters`: This method sets detailed parameters for a specified audio effect. In this release, the supported audio effects are the 3D voice and pitch correction.

**4. Encryption**

This release adds the `EnableEncryption` method for enabling built-in encryption, and deprecates the following methods:

- `SetEncryptionSecret`
- `SetEncryptionMode`

**5. More in-call statistics**

This release adds the following attributes to provide more in-call statistics:

- Adds `txPacketLossRate` in `LocalAudioStats`, which represents the audio packet loss rate (%) from the local client to the Agora edge server before applying anti-packet loss strategies.
- Adds `publishDuration` in `RemoteAudioStats`, which represents the total publish duration (ms) of the remote audio stream.

**6. Audio profile**

To improve audio performance, this release adjusts the maximum audio bitrate of each audio profile as follows:

| Profile                                   | v3.2.1                                                       | Earlier than v3.2.1                                          |
| :---------------------------------------- | :----------------------------------------------------------- | :----------------------------------------------------------- |
| `AUDIO_PROFILE_DEFAULT`                   | For the interactive streaming profile: 64 KbpsFor the communication profile:Windows: 16 KbpsAndroid/iOS/macOS: 18 Kbps | For the interactive streaming profile: 52 KbpsFor the communication profile:Windows: 16 KbpsAndroid/iOS/macOS: 18 Kbps |
| `AUDIO_PROFILE_SPEECH_STANDARD`           | 18 Kbps                                                      | 18 Kbps                                                      |
| `AUDIO_PROFILE_MUSIC_STANDARD`            | 64 Kbps                                                      | 48 Kbps                                                      |
| `AUDIO_PROFILE_MUSIC_STANDARD_STEREO`     | 80 Kbps                                                      | 56 Kbps                                                      |
| `AUDIO_PROFILE_MUSIC_HIGH_QUALITY`        | 96 Kbps                                                      | 128 Kbps                                                     |
| `AUDIO_PROFILE_MUSIC_HIGH_QUALITY_STEREO` | 128 Kbps                                                     | 192 Kbps                                                     |

**7. Log files**

This release increases the default number of log files that the Agora SDK outputs from 2 to 5, and increases the default size of each log file from 512 KB to 1024 KB. By default, the SDK outputs five log files, `agorasdk.log`, `agorasdk_1.log`, `agorasdk_2.log`, `agorasdk_3.log`, `agorasdk_4.log`. The SDK writes the latest logs in `agorasdk.log`. When `agorasdk.log` is full, the SDK deletes the log file with the earliest modification time among the other four, renames `agorasdk.log` to the name of the deleted log file, and creates a new `agorasdk.log` to record the latest logs.

**8. Audio route**

To play audio on more macOS devices, this release adds four enumerators in `AUDIO_ROUTE`, and supports USB, HDMI, DisplayPort peripherals, and Apple AirPlay.

**9. In-ear monitoring improvement on OPPO models**

This release reduces the delay of in-ear monitoring on the following OPPO models:

- Reno4 Pro 5G
- Reno4 5G

#### Issues fixed

This release fixed the following issues:

**Audio**

- `SetAudioMixingPitch` did not work when setting the `pitch` parameter to certain values.
- On iOS devices, occasional audio freeze when disconnecting from a Bluetooth device.
- On macOS devices, the app failed to record any audio because the audio device module failed to start.

**SDK**

- The occasional crashes when leaving a channel on Android devices.
- Crashes on x86 phones running on Android 6 and later.
- On iOS devices, occasional crashes when the user left the channel after talking in multiple channels.

#### API changes

**Added**

- [`SetClientRole`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#a9a31f9b8e45c6528d6f56914619de314)
- [`SetAudioEffectPreset`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#a4bbf600b51a400fe6ab261a95e47bad6)
- [`SetVoiceBeautifierPreset`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#ab4953c6ce75adc42a13297af41676d9a)
- [`SetAudioEffectParameters`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#a9ccf7abdd5f7b4bc0e7f0a7807e34390)
- [`EnableEncryption`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#a54214baf0b421161990eded9c7401976)
- [`OnAudioPublishStateChangedHandler`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/namespaceagora__gaming__rtc.html#aabfff11675d45572de8eb5f28d80ac33)
- [`OnAudioSubscribeStateChangedHandler`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/namespaceagora__gaming__rtc.html#aa0283db27464a1cc827515853db924c5)
- [`OnFirstLocalAudioFramePublishedHandler`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/namespaceagora__gaming__rtc.html#a2be635d5257a7673102e0e0e62c73793)
- `txPacketLossRate` in [`LocalAudioStats`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/structagora__gaming__rtc_1_1_local_audio_stats.html)
- `publishDuration` in [`RemoteAudioStats`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/structagora__gaming__rtc_1_1_remote_audio_stats.html)
- `AUDIO_SCENARIO_MEETING(8)` in [`AUDIO_SCENARIO_TYPE`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/namespaceagora__gaming__rtc.html#a7630f2ee913986430344d4aad26098a3) enum
- `AUDIO_ROUTE_USB`, `AUDIO_ROUTE_HDMI`, `AUDIO_ROUTE_DISPLAYPORT` and `AUDIO_ROUTE_AIRPLAY` in [`AUDIO_ROUTE`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/namespaceagora__gaming__rtc.html#aca310af5a1412fa7a7475b245994b3ae) enum

**Deprecated**

- `SetLocalVoiceChanger`
- `SetLocalVoiceReverbPreset`
- `SetEncryptionSecret`
- `SetEncryptionMode`
- `OnFirstLocalAudioFrameHandler`

## v3.0.1

v3.0.1 was released on September 16, 2020.

In this release, Agora improves the user experience under poor network conditions for both the `COMMUNICATION` and `LIVE_BROADCASTING` profiles through the following measures:

- Adopting a new architecture for the `COMMUNICATION` profile.
- Upgrading the last-mile network strategy for both the `COMMUNICATION` and `LIVE_BROADCASTING` profiles, which enhances the SDK's anti-packet-loss capacity by maximizing the net bitrate when the uplink and downlink bandwidth are insufficient.

To deal with any incompatibility issues caused by the architecture change, Agora uses the fallback mechanism to ensure that users of different versions of the SDKs can communicate with each other: if a user joins the channel from a client using a previous version, all clients using v3.0.1 automatically fall back to the older version. This has the effect that none of the users in the channel can enjoy the improved experience. Therefore we strongly recommend upgrading all your clients to v3.0.1.

If you also use the On-Premise Recording SDK, ensure that you upgrade your On-Premise Recording SDK to v3.0.0 so that all users can enjoy the improvements brought by the new architecture and network strategy.

#### Compatibility changes

**1. Dynamic library replaces the static library (for macOS and iOS)**

This release adds support for a dynamic library and removes the static library. This release renames the library from `AgoraRtcEngineKit.framework` to `AgoraRtcKit.framework`. If you upgrade your SDK to v3.0.1, you must re-import the `AgoraRtcKit` class in Xcode, and set the **Embed** attribute as **Embed & Sign**.

If you integrated the encryption library `AgoraRtcCryptoLoader.framework`, you must re-import the `AgoraRtcCryptoLoader` class in Xcode, and set the **Embed** attribute as **Embed & Sign**.

![](https://web-cdn.agora.io/docs-files/1600240476016)

**2. Enumerator names change**

This release changes `CLIENT_ROLE` to `CLIENT_ROLE_TYPE`, and changes the name of the following members:

- `BROADCASTER` to `CLIENT_ROLE_BROADCASTER`
- `AUDIENCE` to `CLIENT_ROLE_AUDIENCE`

#### New features

**1. Specifying the area of connection**

This release adds `GetEngine2` for specifying the area of connection when creating an `IRtcEngine` instance. This advanced feature applies to scenarios that have regional restrictions. You can choose from areas including Mainland China, North America, Europe, Asia (excluding Mainland China), and global (default).

**2. Multiple channel management**

To enable a user to join an unlimited number of channels at a time, this release adds the `AgoraChannel` class. By creating multiple `AgoraChannel` objects, a user can join the corresponding channels at the same time. Besides, this release adds `SetMultiChannelWant` for enabling the multi-channel mode.

After joining multiple channels, users can receive the audio streams of all the channels, but publish one stream to only one channel at a time. This feature applies to scenarios where users need to receive streams from multiple channels, or frequently switch between channels to publish streams. See <Link to="/3.x/interactive-live-streaming/advanced-features/multiple-channel?platform={{platform.PATH}}">Join multiple channels</Link>.

**3. Audio mixing pitch**

To set the pitch of the local music file during audio mixing, this release adds `SetAudioMixingPitch`. You can set the `pitch` parameter to increase or decrease the pitch of the music file. This method sets the pitch of the local music file only. It does not affect the pitch of a human voice.

**4. Adjusting the playback volume of the specified remote user**

Adds `AdjustUserPlaybackSignalVolume` for adjusting the playback volume of a specified remote user. You can call this method as many times as necessary in a call or the interactive live streaming to adjust the playback volume of different remote users, or to repeatedly adjust the playback volume of the same remote user.

**5. Voice beautifier and audio effects**

To improve the audio quality, this release adds the following enumerate elements in `SetLocalVoiceChanger` and `SetLocalVoiceReverbPreset`:

- `VOICE_CHANGER_PRESET` adds several enumerations that have the prefixes `VOICE_BEAUTY` and `GENERAL_BEAUTY_VOICE`. The `VOICE_BEAUTY`enumerations implement voice timbre transformation, and the `GENERAL_BEAUTY_VOICE` enumerations beautify chat voice.
- `AUDIO_REVERB_PRESET` adds the enumeration `AUDIO_VIRTUAL_STEREO` and several enumerations that have the prefix `AUDIO_REVERB_FX`. The `AUDIO_VIRTUAL_STEREO` enumeration implements reverberation in the virtual stereo, and the `AUDIO_REVERB_FX` enumerations implement voice changer effects, new style transformation effects, and new room acoustics effects.

#### Improvements

**1. Audio profiles**

To meet the need for higher audio quality, this release adjusts the corresponding audio profile of `AUDIO_PROFILE_DEFAULT(0)` in the `LIVE_BROADCASTING` profiles.

| SDK                 | `AUDIO_PROFILE_DEFAULT(0)`                                    |
| :------------------ | :----------------------------------------------------------- |
| v3.0.1              | A sample rate of 48 KHz, music encoding, mono, and a bitrate of up to 52 Kbps. |
| Earlier than v3.0.1 | A sample rate of 32 KHz, music encoding, mono, and a bitrate of up to 44 Kbps. |

**2. Quality statistics**

Adds the following members in the `RtcStats` class for providing more in-call statistics, making it easier to monitor the call quality and memory usage in real time:

- [gatewayRtt](https://api-ref.agora.io/en/video-sdk/ios/3.x/Classes/AgoraChannelStats.html#//api/name/gatewayRtt)
- `memoryAppUsageRatio`
- `memoryTotalUsageRatio`
- `memoryAppUsageInKbytes`

On iOS, to prevent the prompt to find local network devices from popping up when an end user launches the app on an iOS 14.0 device, the [gatewayRtt](https://api-ref.agora.io/en/video-sdk/ios/3.x/Classes/AgoraChannelStats.html#//api/name/gatewayRtt) parameter is disabled by default. See the [FAQ](https://docs.agora.io/en/help/integration-issues/local_network_privacy) for details. If you do not mind the prompt, and want to enable the [gatewayRtt](https://api-ref.agora.io/en/video-sdk/ios/3.x/Classes/AgoraChannelStats.html#//api/name/gatewayRtt) parameter, please contact Agora technical support via [support@agora.io](mailto:support@agora.io).

**3. Others**

This release enables interoperability between the <Vg k="ASDK" /> for Unity and the <Vg k="ASDK" /> for Web by default, and deprecates the `EnableWebSdkInteroperability` method.

#### Issues fixed

- Audio issues relating to audio mixing, audio encoding, and echoing.
- Issues relating to app crashes, log file, and unstable service during Media Push.
- Issues relating to `SendStreamMessage` and the `TranscodingUser` of `SetLiveTranscoding`, which do not support an array format.
- Inaccurate report of the `OnClientRoleChangedHandler` callback, authentication issues with an App ID and token, and a garbled log directory.

#### API changes

**Added**

- [`GetEngine2`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#ac1a02000088c915aa36065325f42d166)
- [`CreateChannel`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#ac14119e2505e2f44931bed0181c5624f)
- [`AgoraChannel`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_agora_channel.html) class
- [`SetMultiChannelWant`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#a50ddfe8050fd11f1537bd0dddc2eb8a3)
- [`SetAudioMixingPitch`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#ac1f7b492430f2c3f38826804a418c2a7)
- [`AdjustUserPlaybackSignalVolume`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/classagora__gaming__rtc_1_1_i_rtc_engine.html#a6ae88c74d0dc4e80837cd0a351f81c00)
- Nine enumerations in [`VOICE_CHANGER_PRESET`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/namespaceagora__gaming__rtc.html#a710b9754965ccb92ed968a562968df2c), such as `VOICE_BEAUTY_VIGOROUS`
- Twelve enumerations in [`AUDIO_REVERB_PRESET`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/namespaceagora__gaming__rtc.html#a1e681589411dd2f5df62dab5c1fca7b9), such as `AUDIO_REVERB_FX_KTV`
- The [[gatewayRtt](https://api-ref.agora.io/en/video-sdk/ios/3.x/Classes/AgoraChannelStats.html#//api/name/gatewayRtt)](https://api-ref.agora.io/en/voice-sdk/unity/3.x/structagora__gaming__rtc_1_1_rtc_stats.html#aef762b5910ca3a7a06a4e37869c34fed), [`memoryAppUsageRatio`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/structagora__gaming__rtc_1_1_rtc_stats.html#a5b7d328a6f8e6aca9e1b8b6c8ce16e02), [`memoryTotalUsageRatio`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/structagora__gaming__rtc_1_1_rtc_stats.html#a232d695be9b723df8dae4ca219c6745f) and [`memoryAppUsageInKbytes`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/structagora__gaming__rtc_1_1_rtc_stats.html#aeb37b39c64362e3954b279c6dfc5e774) members in the `RtcStats` class
- The [`totalActiveTime`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/structagora__gaming__rtc_1_1_remote_audio_stats.html#a7453a27b08439186f35b3b7bb9eafd3b) member in the `RemoteAudioStats` struct
- The [`channelId`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/structagora__gaming__rtc_1_1_audio_volume_info.html#a0b95567512ed7c6642671e805207a8e1) member in the `AudioVolumeInfo` struct

**`Renamed`**

Enum type `CLIENT_ROLE` changed to [`CLIENT_ROLE_TYPE`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/namespaceagora__gaming__rtc.html#a901253f94f78da34371bf7eb656a19ff). Enum name `BROADCASTER` and `AUDIENCE` changed to `CLIENT_ROLE_BROADCASTER` and `CLIENT_ROLE_AUDIENCE`.

**Deprecated**

- `EnableWebSdkInteroperability`
- `OnUserMutedAudioHandler`, `OnFirstRemoteAudioDecodedHandler`, and `OnFirstRemoteAudioFrameHandler`, replaced by [`OnRemoteAudioStateChangedHandler`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/namespaceagora__gaming__rtc.html#a92f016ea980eba06cf38192191d17e01)
- `OnStreamPublishedHandler` and `OnStreamUnpublishedHandler`, replaced by [`OnRtmpStreamingStateChangedHandler`](https://api-ref.agora.io/en/voice-sdk/unity/3.x/namespaceagora__gaming__rtc.html#a589c11ed19b0638824aa1b2e23971271)

## v2.9.2

v2.9.2 is released on Feb 17, 2020.

- This release fixed some abnormal behaviors on Android devices.
- This release fixed the stuck behavior of using the Editor debug mode on Windows platform.

## v2.9.1

Agora Unity SDK is widely used in games, education, AR, VR and other scenarios.

v2.9.1 was released on December 23, 2019.

#### Functions and features

**1. Multi-platform support**
Supports iOS, Android, macOS and Windows (x86/x86-64) platforms.

**2. Interoperability with the Agora Web SDK**
Provides the `EnableWebSdkInteroperability` method for enabling interoperability with the Agora Web SDK in `LIVE_BROADCASTING` profile. 

**3. Raw data**
Supports raw audio data. You can capture and process the raw data according to your needs.

**4. External data source**
Provides APIs for accessing to the external data source. You can configure the external audio source, and push the data to the Agora Unity SDK.

**5. Encryption**
Supports encryption of audio streaming. The following table shows the information of the encryption libraries for the Android and iOS platforms. If you do not intend to use this function, you can remove the encryption libraries to decrease the SDK size.

   | Platform | Encryption libraries                          |
   | :------- | :-------------------------------------------- |
   | Android  | libagora-crypto.so                            |
   | iOS      | <ul><li>AgoraRtcCryptoLoader.framework</li> <li>libcrypto.a</li></ul> |

**6. Cloud proxy**

Supports the cloud proxy service. See [Use Cloud Proxy](../basic-features/use-cloud-proxy) for details.

#### Related documentation

See the following documentation to quickly integrate the SDK and implement real-time voice and video communication in your project.

- [Start a Voice Call](../quickstart-guide/get-started-sdk) or <Link to="/3.x/interactive-live-streaming/quickstart-guide/start-audio-streaming?platform={{platform.PATH}}">Start Live Interactive Audio Streaming</Link>
- [API Reference](https://api-ref.agora.io/en/voice-sdk/unity/3.x/index.html) 

Agora also provides an open-source [Unity Sample](https://github.com/AgoraIO-Extensions/Agora-Unity-Quickstart/tree/3.x/API-Example-Unity) on GitHub.

</PlatformWrapper>